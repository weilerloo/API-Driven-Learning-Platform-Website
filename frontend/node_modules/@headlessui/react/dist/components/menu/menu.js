"use client";import{useFocusRing as ce}from"@react-aria/focus";import{useHover as Te}from"@react-aria/interactions";import C,{Fragment as oe,useCallback as K,useEffect as fe,useRef as J,useState as ye}from"react";import{flushSync as z}from"react-dom";import{useActivePress as Pe}from'../../hooks/use-active-press.js';import{useDisposables as Ee}from'../../hooks/use-disposables.js';import{useElementSize as ge}from'../../hooks/use-element-size.js';import{useEvent as d}from'../../hooks/use-event.js';import{useId as W}from'../../hooks/use-id.js';import{useInertOthers as Me}from'../../hooks/use-inert-others.js';import{useIsoMorphicEffect as V}from'../../hooks/use-iso-morphic-effect.js';import{useOnDisappear as be}from'../../hooks/use-on-disappear.js';import{useOutsideClick as Ae}from'../../hooks/use-outside-click.js';import{useOwnerDocument as ne}from'../../hooks/use-owner.js';import{Action as X,useQuickRelease as _e}from'../../hooks/use-quick-release.js';import{useResolveButtonType as Ie}from'../../hooks/use-resolve-button-type.js';import{useScrollLock as Re}from'../../hooks/use-scroll-lock.js';import{useSlot as Q}from'../../hooks/use-slot.js';import{useSyncRefs as $}from'../../hooks/use-sync-refs.js';import{useTextValue as Se}from'../../hooks/use-text-value.js';import{useTrackedPointer as De}from'../../hooks/use-tracked-pointer.js';import{transitionDataAttributes as Fe,useTransition as he}from'../../hooks/use-transition.js';import{useTreeWalker as xe}from'../../hooks/use-tree-walker.js';import{FloatingProvider as Ce,useFloatingPanel as Le,useFloatingPanelProps as ve,useFloatingReference as He,useFloatingReferenceProps as Oe,useResolvedAnchor as Ue}from'../../internal/floating.js';import{OpenClosedProvider as Ge,State as j,useOpenClosed as ke}from'../../internal/open-closed.js';import{stackMachines as Ne}from'../../machines/stack-machine.js';import{useSlice as S}from'../../react-glue.js';import{isDisabledReactIssue7711 as Be}from'../../utils/bugs.js';import{Focus as _}from'../../utils/calculate-active-index.js';import{disposables as we}from'../../utils/disposables.js';import*as Ke from'../../utils/dom.js';import{Focus as re,FocusableMode as We,focusFrom as Je,isFocusableElement as Ve,restoreFocusIfNecessary as ae}from'../../utils/focus-management.js';import{match as Xe}from'../../utils/match.js';import{RenderFeatures as se,forwardRefWithAs as L,mergeProps as le,useRender as v}from'../../utils/render.js';import{useDescriptions as Qe}from'../description/description.js';import{Keys as c}from'../keyboard.js';import{useLabelContext as $e,useLabels as pe}from'../label/label.js';import{MouseButton as je}from'../mouse.js';import{Portal as qe}from'../portal/portal.js';import{ActionTypes as r,ActivationTrigger as Y,MenuState as y}from'./menu-machine.js';import{MenuContext as ze,useMenuMachine as Ye,useMenuMachineContext as Z}from'./menu-machine-glue.js';let Ze=oe;function et(T,g){let l=W(),{__demoMode:a=!1,...p}=T,s=Ye({id:l,__demoMode:a}),[n,b,P]=S(s,f=>[f.menuState,f.itemsElement,f.buttonElement]),I=$(g),t=Ne.get(null),h=S(t,K(f=>t.selectors.isTop(f,l),[t,l]));Ae(h,[P,b],(f,m)=>{var E;s.send({type:r.CloseMenu}),Ve(m,We.Loose)||(f.preventDefault(),(E=s.state.buttonElement)==null||E.focus())});let R=d(()=>{s.send({type:r.CloseMenu})}),A=Q({open:n===y.Open,close:R}),u={ref:I},M=v();return C.createElement(Ce,null,C.createElement(ze.Provider,{value:s},C.createElement(Ge,{value:Xe(n,{[y.Open]:j.Open,[y.Closed]:j.Closed})},M({ourProps:u,theirProps:p,slot:A,defaultTag:Ze,name:"Menu"}))))}let tt="button";function ot(T,g){let l=Z("Menu.Button"),a=W(),{id:p=`headlessui-menu-button-${a}`,disabled:s=!1,autoFocus:n=!1,...b}=T,P=J(null),I=Oe(),t=$(g,P,He(),d(o=>l.send({type:r.SetButtonElement,element:o}))),h=d(o=>{switch(o.key){case c.Space:case c.Enter:case c.ArrowDown:o.preventDefault(),o.stopPropagation(),l.send({type:r.OpenMenu,focus:{focus:_.First}});break;case c.ArrowUp:o.preventDefault(),o.stopPropagation(),l.send({type:r.OpenMenu,focus:{focus:_.Last}});break}}),R=d(o=>{switch(o.key){case c.Space:o.preventDefault();break}}),[A,u,M]=S(l,o=>[o.menuState,o.buttonElement,o.itemsElement]),f=A===y.Open;_e(f,{trigger:u,action:K(o=>{if(u!=null&&u.contains(o.target))return X.Ignore;let x=o.target.closest('[role="menuitem"]:not([data-disabled])');return Ke.isHTMLElement(x)?X.Select(x):M!=null&&M.contains(o.target)?X.Ignore:X.Close},[u,M]),close:K(()=>l.send({type:r.CloseMenu}),[]),select:K(o=>o.click(),[])});let m=d(o=>{var x;if(o.button===je.Left){if(Be(o.currentTarget))return o.preventDefault();s||(A===y.Open?(z(()=>l.send({type:r.CloseMenu})),(x=P.current)==null||x.focus({preventScroll:!0})):(o.preventDefault(),l.send({type:r.OpenMenu,focus:{focus:_.Nothing},trigger:Y.Pointer})))}}),E=J(null),H=d(o=>{E.current=o.pointerType,o.pointerType==="mouse"&&m(o)}),D=d(o=>{E.current!=="mouse"&&m(o)}),{isFocusVisible:O,focusProps:F}=ce({autoFocus:n}),{isHovered:k,hoverProps:U}=Te({isDisabled:s}),{pressed:N,pressProps:B}=Pe({disabled:s}),i=Q({open:A===y.Open,active:N||A===y.Open,disabled:s,hover:k,focus:O,autofocus:n}),G=le(I(),{ref:t,id:p,type:Ie(T,P.current),"aria-haspopup":"menu","aria-controls":M==null?void 0:M.id,"aria-expanded":A===y.Open,disabled:s||void 0,autoFocus:n,onKeyDown:h,onKeyUp:R,onPointerDown:H,onClick:D},F,U,B);return v()({ourProps:G,theirProps:b,slot:i,defaultTag:tt,name:"Menu.Button"})}let nt="div",rt=se.RenderStrategy|se.Static;function at(T,g){let l=W(),{id:a=`headlessui-menu-items-${l}`,anchor:p,portal:s=!1,modal:n=!0,transition:b=!1,...P}=T,I=Ue(p),t=Z("Menu.Items"),[h,R]=Le(I),A=ve(),[u,M]=ye(null),f=$(g,I?h:null,d(e=>t.send({type:r.SetItemsElement,element:e})),M),[m,E]=S(t,e=>[e.menuState,e.buttonElement]),H=ne(E),D=ne(u);I&&(s=!0);let O=ke(),[F,k]=he(b,u,O!==null?(O&j.Open)===j.Open:m===y.Open);be(F,E,()=>{t.send({type:r.CloseMenu})});let U=S(t,e=>e.__demoMode),N=U?!1:n&&m===y.Open;Re(N,D);let B=U?!1:n&&m===y.Open;Me(B,{allowed:K(()=>[E,u],[E,u])});let G=S(t,t.selectors.didButtonMove)?!1:F;fe(()=>{let e=u;e&&m===y.Open&&e!==(D==null?void 0:D.activeElement)&&e.focus({preventScroll:!0})},[m,u,D]),xe(m===y.Open,{container:u,accept(e){return e.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:e.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(e){e.setAttribute("role","none")}});let q=Ee(),o=d(e=>{var w,ee,te;switch(q.dispose(),e.key){case c.Space:if(t.state.searchQuery!=="")return e.preventDefault(),e.stopPropagation(),t.send({type:r.Search,value:e.key});case c.Enter:if(e.preventDefault(),e.stopPropagation(),t.state.activeItemIndex!==null){let{dataRef:de}=t.state.items[t.state.activeItemIndex];(ee=(w=de.current)==null?void 0:w.domRef.current)==null||ee.click()}t.send({type:r.CloseMenu}),ae(t.state.buttonElement);break;case c.ArrowDown:return e.preventDefault(),e.stopPropagation(),t.send({type:r.GoToItem,focus:_.Next});case c.ArrowUp:return e.preventDefault(),e.stopPropagation(),t.send({type:r.GoToItem,focus:_.Previous});case c.Home:case c.PageUp:return e.preventDefault(),e.stopPropagation(),t.send({type:r.GoToItem,focus:_.First});case c.End:case c.PageDown:return e.preventDefault(),e.stopPropagation(),t.send({type:r.GoToItem,focus:_.Last});case c.Escape:e.preventDefault(),e.stopPropagation(),z(()=>t.send({type:r.CloseMenu})),(te=t.state.buttonElement)==null||te.focus({preventScroll:!0});break;case c.Tab:e.preventDefault(),e.stopPropagation(),z(()=>t.send({type:r.CloseMenu})),Je(t.state.buttonElement,e.shiftKey?re.Previous:re.Next);break;default:e.key.length===1&&(t.send({type:r.Search,value:e.key}),q.setTimeout(()=>t.send({type:r.ClearSearch}),350));break}}),x=d(e=>{switch(e.key){case c.Space:e.preventDefault();break}}),ie=Q({open:m===y.Open}),ue=le(I?A():{},{"aria-activedescendant":S(t,t.selectors.activeDescendantId),"aria-labelledby":S(t,e=>{var w;return(w=e.buttonElement)==null?void 0:w.id}),id:a,onKeyDown:o,onKeyUp:x,role:"menu",tabIndex:m===y.Open?0:void 0,ref:f,style:{...P.style,...R,"--button-width":ge(F,E,!0).width},...Fe(k)}),me=v();return C.createElement(qe,{enabled:s?T.static||F:!1,ownerDocument:H},me({ourProps:ue,theirProps:P,slot:ie,defaultTag:nt,features:rt,visible:G,name:"Menu.Items"}))}let st=oe;function lt(T,g){let l=W(),{id:a=`headlessui-menu-item-${l}`,disabled:p=!1,...s}=T,n=Z("Menu.Item"),b=S(n,i=>n.selectors.isActive(i,a)),P=J(null),I=$(g,P),t=S(n,i=>n.selectors.shouldScrollIntoView(i,a));V(()=>{if(t)return we().requestAnimationFrame(()=>{var i,G;(G=(i=P.current)==null?void 0:i.scrollIntoView)==null||G.call(i,{block:"nearest"})})},[t,P]);let h=Se(P),R=J({disabled:p,domRef:P,get textValue(){return h()}});V(()=>{R.current.disabled=p},[R,p]),V(()=>(n.actions.registerItem(a,R),()=>n.actions.unregisterItem(a)),[R,a]);let A=d(()=>{n.send({type:r.CloseMenu})}),u=d(i=>{if(p)return i.preventDefault();n.send({type:r.CloseMenu}),ae(n.state.buttonElement)}),M=d(()=>{if(p)return n.send({type:r.GoToItem,focus:_.Nothing});n.send({type:r.GoToItem,focus:_.Specific,id:a})}),f=De(),m=d(i=>f.update(i)),E=d(i=>{f.wasMoved(i)&&(p||b||n.send({type:r.GoToItem,focus:_.Specific,id:a,trigger:Y.Pointer}))}),H=d(i=>{f.wasMoved(i)&&(p||b&&n.state.activationTrigger===Y.Pointer&&n.send({type:r.GoToItem,focus:_.Nothing}))}),[D,O]=pe(),[F,k]=Qe(),U=Q({active:b,focus:b,disabled:p,close:A}),N={id:a,ref:I,role:"menuitem",tabIndex:p===!0?void 0:-1,"aria-disabled":p===!0?!0:void 0,"aria-labelledby":D,"aria-describedby":F,disabled:void 0,onClick:u,onFocus:M,onPointerEnter:m,onMouseEnter:m,onPointerMove:E,onMouseMove:E,onPointerLeave:H,onMouseLeave:H},B=v();return C.createElement(O,null,C.createElement(k,null,B({ourProps:N,theirProps:s,slot:U,defaultTag:st,name:"Menu.Item"})))}let pt="div";function it(T,g){let[l,a]=pe(),p=T,s={ref:g,"aria-labelledby":l,role:"group"},n=v();return C.createElement(a,null,n({ourProps:s,theirProps:p,slot:{},defaultTag:pt,name:"Menu.Section"}))}let ut="header";function mt(T,g){let l=W(),{id:a=`headlessui-menu-heading-${l}`,...p}=T,s=$e();V(()=>s.register(a),[a,s.register]);let n={id:a,ref:g,role:"presentation",...s.props};return v()({ourProps:n,theirProps:p,slot:{},defaultTag:ut,name:"Menu.Heading"})}let dt="div";function ct(T,g){let l=T,a={ref:g,role:"separator"};return v()({ourProps:a,theirProps:l,slot:{},defaultTag:dt,name:"Menu.Separator"})}let Tt=L(et),ft=L(ot),yt=L(at),Pt=L(lt),Et=L(it),gt=L(mt),Mt=L(ct),lo=Object.assign(Tt,{Button:ft,Items:yt,Item:Pt,Section:Et,Heading:gt,Separator:Mt});export{lo as Menu,ft as MenuButton,gt as MenuHeading,Pt as MenuItem,yt as MenuItems,Et as MenuSection,Mt as MenuSeparator};
