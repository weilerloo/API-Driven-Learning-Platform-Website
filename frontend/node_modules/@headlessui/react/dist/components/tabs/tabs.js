"use client";import{useFocusRing as re}from"@react-aria/focus";import{useHover as fe}from"@react-aria/interactions";import G,{createContext as ne,useContext as ae,useMemo as le,useReducer as me,useRef as z,useState as Pe}from"react";import{useActivePress as ye}from'../../hooks/use-active-press.js';import{useEvent as F}from'../../hooks/use-event.js';import{useId as oe}from'../../hooks/use-id.js';import{useIsoMorphicEffect as B}from'../../hooks/use-iso-morphic-effect.js';import{useLatestValue as W}from'../../hooks/use-latest-value.js';import{useResolveButtonType as xe}from'../../hooks/use-resolve-button-type.js';import{useSlot as U}from'../../hooks/use-slot.js';import{useSyncRefs as H}from'../../hooks/use-sync-refs.js';import{FocusSentinel as ge}from'../../internal/focus-sentinel.js';import{Hidden as Ae}from'../../internal/hidden.js';import{Focus as y,FocusResult as j,focusIn as I,sortByDomNode as w}from'../../utils/focus-management.js';import{match as O}from'../../utils/match.js';import{microTask as Ee}from'../../utils/micro-task.js';import{getOwnerDocument as Re}from'../../utils/owner.js';import{RenderFeatures as se,forwardRefWithAs as N,mergeProps as ie,useRender as k}from'../../utils/render.js';import{StableCollection as Le,useStableCollectionIndex as pe}from'../../utils/stable-collection.js';import{Keys as x}from'../keyboard.js';var _e=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(_e||{}),Se=(l=>(l[l.Less=-1]="Less",l[l.Equal=0]="Equal",l[l.Greater=1]="Greater",l))(Se||{}),De=(n=>(n[n.SetSelectedIndex=0]="SetSelectedIndex",n[n.RegisterTab=1]="RegisterTab",n[n.UnregisterTab=2]="UnregisterTab",n[n.RegisterPanel=3]="RegisterPanel",n[n.UnregisterPanel=4]="UnregisterPanel",n))(De||{});let Fe={[0](e,r){var d;let t=w(e.tabs,u=>u.current),l=w(e.panels,u=>u.current),a=t.filter(u=>{var T;return!((T=u.current)!=null&&T.hasAttribute("disabled"))}),n={...e,tabs:t,panels:l};if(r.index<0||r.index>t.length-1){let u=O(Math.sign(r.index-e.selectedIndex),{[-1]:()=>1,[0]:()=>O(Math.sign(r.index),{[-1]:()=>0,[0]:()=>0,[1]:()=>1}),[1]:()=>0});if(a.length===0)return n;let T=O(u,{[0]:()=>t.indexOf(a[0]),[1]:()=>t.indexOf(a[a.length-1])});return{...n,selectedIndex:T===-1?e.selectedIndex:T}}let s=t.slice(0,r.index),f=[...t.slice(r.index),...s].find(u=>a.includes(u));if(!f)return n;let b=(d=t.indexOf(f))!=null?d:e.selectedIndex;return b===-1&&(b=e.selectedIndex),{...n,selectedIndex:b}},[1](e,r){if(e.tabs.includes(r.tab))return e;let t=e.tabs[e.selectedIndex],l=w([...e.tabs,r.tab],n=>n.current),a=e.selectedIndex;return e.info.current.isControlled||(a=l.indexOf(t),a===-1&&(a=e.selectedIndex)),{...e,tabs:l,selectedIndex:a}},[2](e,r){return{...e,tabs:e.tabs.filter(t=>t!==r.tab)}},[3](e,r){return e.panels.includes(r.panel)?e:{...e,panels:w([...e.panels,r.panel],t=>t.current)}},[4](e,r){return{...e,panels:e.panels.filter(t=>t!==r.panel)}}},V=ne(null);V.displayName="TabsDataContext";function h(e){let r=ae(V);if(r===null){let t=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,h),t}return r}let Q=ne(null);Q.displayName="TabsActionsContext";function Y(e){let r=ae(Q);if(r===null){let t=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,Y),t}return r}function Ie(e,r){return O(r.type,Fe,e,r)}let he="div";function ve(e,r){let{defaultIndex:t=0,vertical:l=!1,manual:a=!1,onChange:n,selectedIndex:s=null,...g}=e;const f=l?"vertical":"horizontal",b=a?"manual":"auto";let d=s!==null,u=W({isControlled:d}),T=H(r),[p,c]=me(Ie,{info:u,selectedIndex:s!=null?s:t,tabs:[],panels:[]}),v=U({selectedIndex:p.selectedIndex}),m=W(n||(()=>{})),C=W(p.tabs),D=le(()=>({orientation:f,activation:b,...p}),[f,b,p]),P=F(i=>(c({type:1,tab:i}),()=>c({type:2,tab:i}))),R=F(i=>(c({type:3,panel:i}),()=>c({type:4,panel:i}))),A=F(i=>{L.current!==i&&m.current(i),d||c({type:0,index:i})}),L=W(d?e.selectedIndex:p.selectedIndex),_=le(()=>({registerTab:P,registerPanel:R,change:A}),[]);B(()=>{c({type:0,index:s!=null?s:t})},[s]),B(()=>{if(L.current===void 0||p.tabs.length<=0)return;let i=w(p.tabs,S=>S.current);i.some((S,X)=>p.tabs[X]!==S)&&A(i.indexOf(p.tabs[L.current]))});let K={ref:T},J=k();return G.createElement(Le,null,G.createElement(Q.Provider,{value:_},G.createElement(V.Provider,{value:D},D.tabs.length<=0&&G.createElement(ge,{onFocus:()=>{var i,M;for(let S of C.current)if(((i=S.current)==null?void 0:i.tabIndex)===0)return(M=S.current)==null||M.focus(),!0;return!1}}),J({ourProps:K,theirProps:g,slot:v,defaultTag:he,name:"Tabs"}))))}let Ce="div";function Me(e,r){let{orientation:t,selectedIndex:l}=h("Tab.List"),a=H(r),n=U({selectedIndex:l}),s=e,g={ref:a,role:"tablist","aria-orientation":t};return k()({ourProps:g,theirProps:s,slot:n,defaultTag:Ce,name:"Tabs.List"})}let Ge="button";function Ue(e,r){var Z,ee;let t=oe(),{id:l=`headlessui-tabs-tab-${t}`,disabled:a=!1,autoFocus:n=!1,...s}=e,{orientation:g,activation:f,selectedIndex:b,tabs:d,panels:u}=h("Tab"),T=Y("Tab"),p=h("Tab"),[c,v]=Pe(null),m=z(null),C=H(m,r,v);B(()=>T.registerTab(m),[T,m]);let D=pe("tabs"),P=d.indexOf(m);P===-1&&(P=D);let R=P===b,A=F(o=>{var $;let E=o();if(E===j.Success&&f==="auto"){let q=($=Re(m))==null?void 0:$.activeElement,te=p.tabs.findIndex(be=>be.current===q);te!==-1&&T.change(te)}return E}),L=F(o=>{let E=d.map(q=>q.current).filter(Boolean);if(o.key===x.Space||o.key===x.Enter){o.preventDefault(),o.stopPropagation(),T.change(P);return}switch(o.key){case x.Home:case x.PageUp:return o.preventDefault(),o.stopPropagation(),A(()=>I(E,y.First));case x.End:case x.PageDown:return o.preventDefault(),o.stopPropagation(),A(()=>I(E,y.Last))}if(A(()=>O(g,{vertical(){return o.key===x.ArrowUp?I(E,y.Previous|y.WrapAround):o.key===x.ArrowDown?I(E,y.Next|y.WrapAround):j.Error},horizontal(){return o.key===x.ArrowLeft?I(E,y.Previous|y.WrapAround):o.key===x.ArrowRight?I(E,y.Next|y.WrapAround):j.Error}}))===j.Success)return o.preventDefault()}),_=z(!1),K=F(()=>{var o;_.current||(_.current=!0,(o=m.current)==null||o.focus({preventScroll:!0}),T.change(P),Ee(()=>{_.current=!1}))}),J=F(o=>{o.preventDefault()}),{isFocusVisible:i,focusProps:M}=re({autoFocus:n}),{isHovered:S,hoverProps:X}=fe({isDisabled:a}),{pressed:ue,pressProps:Te}=ye({disabled:a}),de=U({selected:R,hover:S,active:ue,focus:i,autofocus:n,disabled:a}),ce=ie({ref:C,onKeyDown:L,onMouseDown:J,onClick:K,id:l,role:"tab",type:xe(e,c),"aria-controls":(ee=(Z=u[P])==null?void 0:Z.current)==null?void 0:ee.id,"aria-selected":R,tabIndex:R?0:-1,disabled:a||void 0,autoFocus:n},M,X,Te);return k()({ourProps:ce,theirProps:s,slot:de,defaultTag:Ge,name:"Tabs.Tab"})}let He="div";function we(e,r){let{selectedIndex:t}=h("Tab.Panels"),l=H(r),a=U({selectedIndex:t}),n=e,s={ref:l};return k()({ourProps:s,theirProps:n,slot:a,defaultTag:He,name:"Tabs.Panels"})}let Oe="div",Ne=se.RenderStrategy|se.Static;function ke(e,r){var R,A,L,_;let t=oe(),{id:l=`headlessui-tabs-panel-${t}`,tabIndex:a=0,...n}=e,{selectedIndex:s,tabs:g,panels:f}=h("Tab.Panel"),b=Y("Tab.Panel"),d=z(null),u=H(d,r);B(()=>b.registerPanel(d),[b,d]);let T=pe("panels"),p=f.indexOf(d);p===-1&&(p=T);let c=p===s,{isFocusVisible:v,focusProps:m}=re(),C=U({selected:c,focus:v}),D=ie({ref:u,id:l,role:"tabpanel","aria-labelledby":(A=(R=g[p])==null?void 0:R.current)==null?void 0:A.id,tabIndex:c?a:-1},m),P=k();return!c&&((L=n.unmount)==null||L)&&!((_=n.static)!=null&&_)?G.createElement(Ae,{"aria-hidden":"true",...D}):P({ourProps:D,theirProps:n,slot:C,defaultTag:Oe,features:Ne,visible:c,name:"Tabs.Panel"})}let Be=N(Ue),We=N(ve),je=N(Me),Ke=N(we),Je=N(ke),ct=Object.assign(Be,{Group:We,List:je,Panels:Ke,Panel:Je});export{ct as Tab,We as TabGroup,je as TabList,Je as TabPanel,Ke as TabPanels};
